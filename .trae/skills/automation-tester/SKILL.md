---
name: "automation-tester"
description: "自动化测试工具，用于通过接口逐步发掘方法，抽象业务模型并记录测试结果。当用户需要测试接口时触发，支持Java探针验证代码输出。"
---

# 自动化测试工具

## 功能概述

本skill提供全面的自动化测试能力，通过以下步骤实现接口测试的自动化：

1. **接口发掘**：通过要测试的接口，逐步往下发掘所有相关方法
2. **业务模型抽象**：将每个方法抽象为业务模型，包含：
   - 输入对象的信息
   - 中间处理过程（所有读IO操作，对象转换，属性值修改等）
   - 输出（所有写IO操作）
3. **测试结果记录**：对于每个方法，将抽象出来的业务模型、测试结果（正常/不正常）记录到单独的skill文件中
4. **动态加载**：进行接口测试时，动态加载接口使用到的方法的skill文件
5. **智能跳过**：如果方法已经测试过没问题，不需要加载该skill防止提示词爆炸
6. **新方法测试**：如果方法没有测试过，新开一个agent测试该方法生成skill文件
7. **最终测试**：直到所有方法均测试没有问题，再进行最终接口测试
8. **Java探针验证**：对于方法测试，使用Java探针：
   - 大模型根据输入对象预测每行代码的输出
   - 探针拦截真实输出
   - 通过脚本对比真实输出与预测输出是否一致
   - 不一致时作为todolist返回给用户并写入该方法的skill中

## 使用场景

- 当需要测试新的接口时
- 当接口依赖的方法发生变化时
- 当需要确保整个接口调用链的可靠性时

## 工作流程

1. **初始化测试**：加载automation-tester skill
2. **接口分析**：分析要测试的接口，识别所有调用的方法
3. **方法测试**：
   - 检查方法是否已有测试通过的skill文件
   - 如有，跳过测试
   - 如无，创建新agent测试该方法
   - 使用Java探针验证代码执行结果
   - 生成包含业务模型和测试结果的skill文件
4. **依赖解析**：递归处理方法依赖的其他方法
5. **最终测试**：所有方法测试通过后，执行完整接口测试
6. **结果汇总**：生成测试报告，包含所有方法的测试状态

## 测试结果记录

每个方法的测试结果会记录在单独的skill文件中，格式如下：

```markdown
---
name: "method-<method-name>"
description: "测试结果记录 - <method-name>"
test_result: "正常/不正常"
---

# <method-name> 业务模型

## 输入
- 输入对象：<对象类型> - <对象描述>
- 输入参数：<参数列表>

## 中间处理过程
- <处理步骤1>
- <处理步骤2>
- ...

## 输出
- <输出操作1>
- <输出操作2>
- ...

## 测试结果
- 预测输出：<预测结果>
- 真实输出：<真实结果>
- 对比结果：<一致/不一致>
- 问题描述：<如果不一致，描述问题>
```

## 技术实现

- **Java探针**：用于拦截和记录代码执行过程中的真实输出
- **动态代理**：用于在测试过程中监控方法调用
- **Agent机制**：用于并行测试多个方法
- **Skill文件管理**：用于存储和加载测试结果

## 调用示例

```java
// 测试接口示例
@Test
public void testApi() {
    // 加载automation-tester skill
    // 分析接口依赖的方法
    // 测试未测试过的方法
    // 执行完整接口测试
    // 验证结果
}
```

## 注意事项

- 确保Java探针正确配置并能够拦截目标方法的执行
- 对于复杂的方法，可能需要多次测试才能生成准确的业务模型
- 测试过程中会生成多个skill文件，需要合理管理这些文件
- 对于性能敏感的方法，测试可能会影响系统性能，建议在测试环境执行
